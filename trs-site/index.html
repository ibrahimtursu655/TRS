<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRS ‚Äî G√ºvenli Gelecek</title>
  <link rel="icon" type="image/png" href="images/favicon.png">

  <style>
    :root{
      --bg:#0a0a0a;--text:#e7e7e7;--muted:#a9a9a9;--gold:#d4af37;--accent:#00d8ff;--radius:18px;--shadow:0 10px 30px rgba(0,0,0,.45)
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:Poppins,sans-serif;line-height:1.6;overflow-x:hidden}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;background:rgba(10,10,10,.55);border-bottom:1px solid rgba(255,255,255,.06);z-index:1000}
    .nav{display:flex;align-items:center;justify-content:space-between;height:78px}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text)}
    .brand img{height:48px;border-radius:8px}
    nav a{color:var(--text);text-decoration:none;margin:0 12px;font-weight:600;position:relative;opacity:.9;padding:6px 2px}
    nav a:hover{opacity:1}
    nav a:after{content:"";position:absolute;left:0;bottom:-6px;height:2px;width:0;background:linear-gradient(90deg,var(--gold),var(--accent));transition:width .25s}
    nav a:hover:after{width:100%}
    .cta{display:inline-flex;align-items:center;gap:10px;padding:10px 18px;border-radius:999px;text-decoration:none;background:linear-gradient(135deg,var(--gold),#b58913);color:#111;font-weight:800;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.15)}

    section{padding:60px 0}
    h1,h2,h3{margin-bottom:20px}
    a{cursor:pointer}

    /* Yorumlar */
    .comment-section{border-top:1px solid rgba(255,255,255,0.1)}
    .comment-form{display:flex;flex-direction:column;gap:10px;max-width:600px;margin:0 auto}
    .comment-form input,.comment-form textarea,.comment-form select{padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.08);color:#fff}
    .comment-form button{align-self:flex-end;padding:10px 18px;border-radius:10px;background:var(--gold);color:#111;font-weight:700;border:none;cursor:pointer}
    .comment-controls{max-width:800px;margin:20px auto;text-align:right}
    .comment-list{max-width:800px;margin:20px auto 0;display:grid;gap:12px}
    .comment-item{background:rgba(255,255,255,0.03);padding:14px;border-radius:12px;position:relative}
    .comment-item .meta{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .comment-item .avatar{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--accent));display:flex;align-items:center;justify-content:center;color:#111;font-weight:700}
    .comment-item .name{font-weight:700;color:var(--gold)}
    .comment-item .rating{color:var(--accent)}
    .comment-item p{margin-top:6px;color:var(--text);line-height:1.4}
    .comment-item .delete-btn{position:absolute;top:8px;right:8px;padding:4px 8px;border:none;border-radius:6px;background:rgba(255,0,0,0.6);color:#fff;cursor:pointer;font-size:0.8rem}

    .pagination{max-width:800px;margin:30px auto 0;text-align:center}
    .pagination button{margin:0 5px;padding:8px 14px;border:none;border-radius:8px;background:rgba(255,255,255,0.08);color:#fff;cursor:pointer}
    .pagination button.active{background:var(--gold);color:#111;font-weight:700}

    /* Modallar */
    .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:4000;align-items:center;justify-content:center}
    .box{background:#111;padding:24px;border-radius:12px;max-width:400px;text-align:center;color:#fff}
    .box h3{margin-bottom:20px;color:var(--gold)}
    .box button{margin:0 10px;padding:8px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:600}
    .accept{background:var(--gold);color:#111}
    .cancel{background:rgba(255,255,255,0.08);color:#fff}
    .notify-overlay{display:none;position:fixed;inset:0;backdrop-filter:blur(6px);background:rgba(0,0,0,0.45);z-index:3000;align-items:center;justify-content:center}
    .notify{background:#0f0f0f;padding:28px;border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,.6);text-align:center;color:#fff;max-width:420px;position:relative}
    .notify .close{position:absolute;right:12px;top:10px;color:#fff;font-size:20px;cursor:pointer}
  </style>
</head>
<body>

<header>
  <div class="container nav">
    <a href="#" class="brand"><img src="images/logo.png" alt="TRS Logo"><span>G√ºvenli Gelecek</span></a>
    <nav>
      <a href="#hero">Ana Sayfa</a>
      <a href="#urunler">√úr√ºnler</a>
      <a href="#hakkimizda">Hakkƒ±mƒ±zda</a>
      <a href="#iletisim">ƒ∞leti≈üim</a>
      <a class="cta" id="teklifBtn">Teklif Al</a>
    </nav>
  </div>
</header>

<section id="hero" style="height:420px; display:grid; place-items:center; text-align:center;">
  <div class="container">
    <h1 style="font-size:2rem;color:var(--gold)">TRS ‚Äî G√ºvenli Gelecek</h1>
    <p style="color:var(--muted)">Ana sayfa i√ßeriƒüi buraya gelecek. A≈üaƒüƒ±ya kaydƒ±rarak yorumlarƒ± g√∂rebilirsiniz.</p>
  </div>
</section>

<section id="urunler">
  <div class="container"><h2>√úr√ºnler</h2></div>
</section>

<section id="hakkimizda">
  <div class="container"><h2>Hakkƒ±mƒ±zda</h2></div>
</section>

<section id="iletisim">
  <div class="container"><h2>ƒ∞leti≈üim</h2></div>
</section>

<section class="comment-section" id="yorumlar">
  <div class="container">
    <h2>üí¨ Yorumlar</h2>
    <form class="comment-form" id="commentForm">
      <input type="text" id="fullName" placeholder="Adƒ±nƒ±z Soyadƒ±nƒ±z" required>
      <select id="rating" required>
        <option value="" disabled selected>Puan verin</option>
        <option value="1">1 ‚Äî ‚≠ê</option>
        <option value="2">2 ‚Äî ‚≠ê‚≠ê</option>
        <option value="3">3 ‚Äî ‚≠ê‚≠ê‚≠ê</option>
        <option value="4">4 ‚Äî ‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="5">5 ‚Äî ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
      </select>
      <textarea id="message" placeholder="Yorumunuz..." required rows="5"></textarea>
      <button type="submit">G√∂nder</button>
    </form>
    <div class="comment-controls">
      <label for="sortSelect">Sƒ±rala: </label>
      <select id="sortSelect">
        <option value="timestamp_desc">En Yeni</option>
        <option value="timestamp_asc">En Eski</option>
        <option value="rating_desc">En Y√ºksek Puan</option>
        <option value="rating_asc">En D√º≈ü√ºk Puan</option>
      </select>
    </div>
    <div class="comment-list" id="commentList"></div>
    <div class="pagination" id="pagination"></div>
  </div>
</section>

<div class="notify-overlay" id="notifyOverlay">
  <div class="notify" id="notifyBox">
    <div class="close" id="notifyClose">√ó</div>
    <div class="text" id="notifyText">Ba≈üarƒ±yla g√∂nderildi.</div>
  </div>
</div>

<div class="overlay" id="confirmOverlay">
  <div class="box">
    <h3>Bu yorumu silmek istediƒüinize emin misiniz?</h3>
    <button class="accept" id="confirmAccept">Kabul Ediyorum</button>
    <button class="cancel" id="confirmCancel">Vazge√ßiyorum</button>
  </div>
</div>

<div class="overlay" id="popup">
  <div class="box">
    <span class="close-btn" id="closePopup">√ó</span>
    <h3>ƒ∞leti≈üim Se√ßiniz</h3>
    <a id="phoneOption">üìû Telefonla Ara / WhatsApp</a><br>
    <a id="gmailOption">üìß E-Posta G√∂nder</a>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = { apiKey:"AIzaSyAyA9Wb5eETRMUFzpqPSWX4d-o9SjYZClk", authDomain:"trs-yorumlar.firebaseapp.com", projectId:"trs-yorumlar", storageBucket:"trs-yorumlar.appspot.com", messagingSenderId:"587642499585", appId:"1:587642499585:web:5d07f7912249a77fdf8600" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const commentForm=document.getElementById('commentForm'),
        commentList=document.getElementById('commentList'),
        pagination=document.getElementById('pagination'),
        sortSelect=document.getElementById('sortSelect'),
        confirmOverlay=document.getElementById('confirmOverlay'),
        confirmAccept=document.getElementById('confirmAccept'),
        confirmCancel=document.getElementById('confirmCancel'),
        popup=document.getElementById('popup'),
        teklifBtn=document.getElementById('teklifBtn'),
        closePopup=document.getElementById('closePopup'),
        phoneOption=document.getElementById('phoneOption'),
        gmailOption=document.getElementById('gmailOption'),
        notifyOverlay=document.getElementById('notifyOverlay'),
        notifyClose=document.getElementById('notifyClose'),
        notifyBox=document.getElementById('notifyBox'),
        notifyText=document.getElementById('notifyText');

  const BAD_WORDS=['siktir','orospu','pi√ß','amcƒ±k','yarak','g√∂t','fuck','shit','bitch'];
  const currentUser='demoUser';
  let commentsData=[], currentPage=1, perPage=10, deleteTargetId=null;

  function escapeHtml(str){return String(str||'').replace(/[&<>"'\/]/g,s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;'}[s]));}
  function maskName(n){if(!n) return ''; const p=n.split(' '); return p.map(x=> (x && x[0]) ? x[0].toUpperCase()+'*'.repeat(Math.max(3,x.length-1)) : '' ).join(' '); }
  function containsBadWord(t){if(!t) return false; const s=t.toLowerCase(); return BAD_WORDS.some(w=> new RegExp('\\b'+w.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\$&')+'\\b','i').test(s));}
  function showNotify({type='success',title='',reason=''}){
    notifyBox.style.background = (type==='success') ? '#0f0f0f' : '#f00';
    notifyText.textContent = title;
    notifyOverlay.style.display='flex';
  }
  notifyClose.onclick = ()=>{ notifyOverlay.style.display='none'; };

  function renderComments(){
    commentList.innerHTML='';
    const start=(currentPage-1)*perPage;
    const pageData=commentsData.slice(start,start+perPage);
    pageData.forEach(d=>{
      const item=document.createElement('div'); item.className='comment-item';
      const isOwner=(d.userId===currentUser)||(d.userId==='admin');
      const avatarChar=escapeHtml((maskName(d.fullName)||'').charAt(0)||'');
      item.innerHTML=`
        <div class="meta">
          <div class="avatar">${avatarChar}</div>
          <div>
            <div class="name">${escapeHtml(maskName(d.fullName))}</div>
            <div class="rating">${'‚≠ê'.repeat(d.rating||0)}</div>
          </div>
        </div>
        <p>${escapeHtml(d.message)}</p>
        ${isOwner?'<button class="delete-btn">Sil</button>':''}
      `;
      if(isOwner){
        const delBtn=item.querySelector('.delete-btn');
        delBtn.addEventListener('click',()=>{ deleteTargetId=d.id; confirmOverlay.style.display='flex'; });
      }
      commentList.appendChild(item);
    });
    renderPagination();
  }

  function renderPagination(){
    pagination.innerHTML='';
    const totalPages=Math.max(1,Math.ceil(commentsData.length/perPage));
    for(let i=1;i<=totalPages;i++){
      const btn=document.createElement('button'); btn.textContent=i;
      if(i===currentPage) btn.classList.add('active');
      btn.addEventListener('click',()=>{currentPage=i; renderComments();});
      pagination.appendChild(btn);
    }
  }

  function fetchComments(){
    let orderField='timestamp', dir='desc';
    const val=sortSelect.value;
    if(val==='rating_desc'){orderField='rating'; dir='desc';} 
    else if(val==='rating_asc'){orderField='rating'; dir='asc';} 
    else if(val==='timestamp_asc'){dir='asc';}
    db.collection('comments').orderBy(orderField,dir).onSnapshot(snap=>{
      commentsData=snap.docs.map(doc=>({id:doc.id,...doc.data()}));
      currentPage=1;
      renderComments();
    });
  }

  sortSelect.onchange = ()=>{ fetchComments(); }
  fetchComments();

  commentForm.onsubmit=async e=>{
    e.preventDefault();
    const fullName=document.getElementById('fullName').value.trim();
    const rating=parseInt(document.getElementById('rating').value||'0',10);
    const message=document.getElementById('message').value.trim();
    if(!fullName||!rating||!message){ showNotify({type:'error',title:'T√ºm alanlarƒ± doldurun'}); return;}
    if(containsBadWord(fullName)||containsBadWord(message)){ showNotify({type:'error',title:'Uygunsuz kelime tespit edildi'}); return;}
    try{
      await db.collection('comments').add({fullName,rating,message,timestamp:firebase.firestore.FieldValue.serverTimestamp(),userId:currentUser});
      showNotify({type:'success',title:'Yorum eklendi'});
      commentForm.reset();
    }catch(err){showNotify({type:'error',title:'Yorum eklenemedi'});}
  }

  confirmAccept.onclick=async()=>{if(!deleteTargetId){confirmOverlay.style.display='none';return;} try{await db.collection('comments').doc(deleteTargetId).delete(); confirmOverlay.style.display='none'; deleteTargetId=null;}catch(err){showNotify({type:'error',title:'Silinemedi'});}}
  confirmCancel.onclick=()=>{confirmOverlay.style.display='none'; deleteTargetId=null;}

  // Popup
  teklifBtn.onclick=e=>{e.preventDefault(); popup.style.display='flex'; document.body.style.overflow='hidden';}
  closePopup.onclick=()=>{popup.style.display='none'; document.body.style.overflow='auto';}
  popup.onclick=e=>{if(e.target===popup){popup.style.display='none';document.body.style.overflow='auto';}}
  function isMobile(){return /Mobi|Android|iPhone|iPad|IEMobile|Opera Mini/i.test(navigator.userAgent);}
  const phone="+905510979299", whatsapp="905510979299", wpText=encodeURIComponent("Merhaba TRS, teklif almak istiyorum.");
  phoneOption.onclick=e=>{e.preventDefault(); if(isMobile()){window.location.href="tel:"+phone;} else {window.open("https://web.whatsapp.com/send?phone="+whatsapp+"&text="+wpText,"_blank");} popup.style.display='none'; document.body.style.overflow='auto';}
  gmailOption.onclick=e=>{e.preventDefault(); window.open("https://mail.google.com/mail/?view=cm&fs=1&to=trsturkeyofficial@gmail.com&su=Teklif%20Talebi&body=Merhaba%20TRS,%20bir%20teklif%20almak%20istiyorum.","_blank"); popup.style.display='none'; document.body.style.overflow='auto';}
</script>

</body>
</html>
