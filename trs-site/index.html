<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>TRS ‚Äî G√ºvenli Gelecek</title>
  <link rel="icon" type="image/png" href="images/favicon.png">

  <style>
    :root{--bg:#0a0a0a;--text:#e7e7e7;--muted:#a9a9a9;--gold:#d4af37;--accent:#00d8ff;--radius:18px;--shadow:0 10px 30px rgba(0,0,0,.45)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:var(--bg);color:var(--text);font-family:Poppins,sans-serif;line-height:1.6;overflow-x:hidden}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;background:rgba(10,10,10,.55);border-bottom:1px solid rgba(255,255,255,.06);z-index:1000}
    .nav{display:flex;align-items:center;justify-content:space-between;height:78px}
    .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text)}
    .brand img{height:48px;border-radius:8px}
    nav a{color:var(--text);text-decoration:none;margin:0 12px;font-weight:600;position:relative;opacity:.9;padding:6px 2px}
    nav a:hover{opacity:1}
    nav a:after{content:"";position:absolute;left:0;bottom:-6px;height:2px;width:0;background:linear-gradient(90deg,var(--gold),var(--accent));transition:width .25s}
    nav a:hover:after{width:100%}
    .cta{display:inline-flex;align-items:center;gap:10px;padding:10px 18px;border-radius:999px;text-decoration:none;background:linear-gradient(135deg,var(--gold),#b58913);color:#111;font-weight:800;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,.15)}
    /* (sayfanƒ±n geri kalan √∂zg√ºn stillerini bozmadan yorum alanƒ± ve modal stilleri eklenmi≈ütir) */

    /* Yorumlar */
    .comment-section{padding:70px 0;border-top:1px solid rgba(255,255,255,0.1)}
    .comment-section h2{text-align:center;color:var(--gold);margin-bottom:20px}
    .comment-form{display:flex;flex-direction:column;gap:10px;max-width:600px;margin:0 auto}
    .comment-form input,.comment-form textarea,.comment-form select{padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.08);color:#fff}
    .comment-form button{align-self:flex-end;padding:10px 18px;border-radius:10px}
    .comment-list{max-width:800px;margin:30px auto 0;display:grid;gap:12px}
    .comment-item{background:rgba(255,255,255,0.03);padding:14px;border-radius:12px}
    .comment-item .meta{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .comment-item .avatar{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--accent));display:flex;align-items:center;justify-content:center;color:#111;font-weight:700}
    .comment-item .name{font-weight:700;color:var(--gold)}
    .comment-item .rating{color:var(--accent)}
    .comment-item p{margin-top:6px;color:var(--text);line-height:1.4}

    /* Bildirim modal (ba≈üarƒ± / hata) */
    .notify-overlay{display:none;position:fixed;inset:0;backdrop-filter:blur(6px);background:rgba(0,0,0,0.45);z-index:3000;align-items:center;justify-content:center}
    .notify{background:#0f0f0f;padding:28px;border-radius:14px;box-shadow:0 10px 40px rgba(0,0,0,.6);text-align:center;color:#fff;max-width:420px;position:relative}
    .notify .close{position:absolute;right:12px;top:10px;color:#fff;font-size:20px;cursor:pointer}
    .notify .icon-wrap{width:96px;height:96px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;position:relative}
    /* ye≈üil */
    .notify.success .icon-wrap{background:conic-gradient(from 0deg, rgba(0,200,0,.15) 0, transparent 0);border:4px solid rgba(0,200,0,0.12)}
    .notify.success .icon{width:60px;height:60px;border-radius:50%;background:#0f0;padding:10px;display:flex;align-items:center;justify-content:center;color:#063}
    /* kƒ±rmƒ±zƒ± */
    .notify.error .icon-wrap{background:conic-gradient(from 0deg, rgba(255,0,0,.12) 0, transparent 0);border:4px solid rgba(255,0,0,0.12)}
    .notify.error .icon{width:60px;height:60px;border-radius:50%;background:#f00;padding:10px;display:flex;align-items:center;justify-content:center;color:#fff}

    /* k√º√ß√ºk animasyon (√ßember animasyonu i√ßin) */
    .ring { position:absolute; inset: -12px; border-radius:50%; border:3px solid rgba(255,255,255,0.06); animation:spin 1.2s linear; }
    @keyframes spin { from { transform: rotate(0deg) } to { transform: rotate(360deg) } }

    /* hata metni */
    .notify .text{margin-top:8px;color:#fff}
    .notify .reason{margin-top:10px;color:#ffd6d6;font-size:0.95rem}

    /* responsive */
    @media(max-width:640px){.notify{width:92%;padding:20px}}
  </style>
</head>
<body>

  <!-- --- (Sayfanƒ±n orijinal header / hero / b√∂l√ºmleri burada) --- -->
  <header>
    <div class="container nav">
      <a href="#" class="brand"><img src="images/logo.png" alt="TRS Logo"><span>G√ºvenli Gelecek</span></a>
      <nav>
        <a href="#hero">Ana Sayfa</a>
        <a href="#urunler">√úr√ºnler</a>
        <a href="#hakkimizda">Hakkƒ±mƒ±zda</a>
        <a href="#iletisim">ƒ∞leti≈üim</a>
        <a class="cta" href="#" id="teklifBtn">Teklif Al</a>
      </nav>
    </div>
  </header>

  <!-- ... diƒüer b√∂l√ºmler (hero, √ºr√ºnler, hakkƒ±mƒ±zda, ileti≈üim) --->
  <section class="comment-section" id="yorumlar">
    <div class="container">
      <h2>üí¨ Yorumlar</h2>
      <form class="comment-form" id="commentForm">
        <input type="text" id="fullName" placeholder="Adƒ±nƒ±z Soyadƒ±nƒ±z (√∂r: Ahmet Yƒ±lmaz)" required>
        <select id="rating" required>
          <option value="" disabled selected>Puan verin</option>
          <option value="1">1 ‚Äî ‚≠ê</option>
          <option value="2">2 ‚Äî ‚≠ê‚≠ê</option>
          <option value="3">3 ‚Äî ‚≠ê‚≠ê‚≠ê</option>
          <option value="4">4 ‚Äî ‚≠ê‚≠ê‚≠ê‚≠ê</option>
          <option value="5">5 ‚Äî ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
        </select>
        <textarea id="message" placeholder="Yorumunuz..." required rows="5"></textarea>
        <button type="submit">G√∂nder</button>
      </form>

      <div class="comment-list" id="commentList"></div>
    </div>
  </section>

  <!-- Bildirim modal (ba≈üarƒ± / hata) -->
  <div class="notify-overlay" id="notifyOverlay" aria-hidden="true">
    <div class="notify" id="notifyBox">
      <div class="close" id="notifyClose">√ó</div>
      <div class="icon-wrap">
        <div class="ring" id="ringAnim" style="display:none"></div>
        <div class="icon" id="notifyIcon">‚úì</div>
      </div>
      <div class="text" id="notifyText">Ba≈üarƒ±yla g√∂nderildi.</div>
      <div class="reason" id="notifyReason" style="display:none"></div>
    </div>
  </div>

  <!-- POPUP (Teklif Al) - mevcut kodu bozmadan korudum -->
  <div class="popup-overlay" id="popup">
    <div class="popup">
      <span class="close-btn" id="closePopup">√ó</span>
      <h3>ƒ∞leti≈üim Se√ßiniz</h3>
      <a href="#" id="phoneOption">üìû Telefonla Ara / WhatsApp</a>
      <a href="#" id="gmailOption">üìß E-Posta G√∂nder</a>
    </div>
  </div>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ========== Firebase config - senin proje bilgilerin ==========
    const firebaseConfig = {
      apiKey: "AIzaSyAyA9Wb5eETRMUFzpqPSWX4d-o9SjYZClk",
      authDomain: "trs-yorumlar.firebaseapp.com",
      projectId: "trs-yorumlar",
      storageBucket: "trs-yorumlar.appspot.com",
      messagingSenderId: "587642499585",
      appId: "1:587642499585:web:5d07f7912249a77fdf8600",
      measurementId: "G-GM11C7LFVC"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ========== Popup (mevcut teklif al) ==========
    const teklifBtn = document.getElementById('teklifBtn');
    const popup = document.getElementById('popup');
    const closePopup = document.getElementById('closePopup');
    const phoneOption = document.getElementById('phoneOption');
    const gmailOption = document.getElementById('gmailOption');

    teklifBtn.addEventListener('click', e=>{e.preventDefault(); popup.style.display='flex'; document.body.style.overflow='hidden';});
    closePopup.addEventListener('click', ()=>{ popup.style.display='none'; document.body.style.overflow='auto';});
    popup.addEventListener('click', e=>{ if(e.target===popup){ popup.style.display='none'; document.body.style.overflow='auto'; } });
    function isMobileDevice(){ return /Mobi|Android|iPhone|iPad|IEMobile|Opera Mini/i.test(navigator.userAgent); }
    const businessPhone = "+905510979299";
    const whatsappNumber = "905510979299";
    const whatsappPrefill = encodeURIComponent("Merhaba TRS, teklif almak istiyorum. (Site √ºzerinden geldim.)");
    phoneOption.addEventListener('click', e=>{ e.preventDefault(); if(isMobileDevice()){ window.location.href = "tel:" + businessPhone; } else { window.open("https://web.whatsapp.com/send?phone="+whatsappNumber+"&text="+whatsappPrefill,"_blank"); } popup.style.display='none'; document.body.style.overflow='auto';});
    const gmailLink = "https://mail.google.com/mail/?view=cm&fs=1&to=trsturkeyofficial@gmail.com&su=Teklif%20Talebi&body=Merhaba%20TRS,%20bir%20teklif%20almak%20istiyorum.";
    gmailOption.addEventListener('click', e=>{ e.preventDefault(); window.open(gmailLink,"_blank"); popup.style.display='none'; document.body.style.overflow='auto'; });

    // ========== Yardƒ±mcƒ± fonksiyonlar ==========
    function escapeHtml(str){
      return String(str).replace(/[&<>"'\/]/g, function (s) {
        const map = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;'};
        return map[s];
      });
    }

    function maskName(fullName){
      // "Ahmet Yƒ±lmaz" -> "A**** Y****"
      if(!fullName) return '';
      const parts = fullName.trim().split(/\s+/);
      if(parts.length === 1){
        const p = parts[0];
        return p[0].toUpperCase() + ' ' + '*****';
      }
      const first = parts[0];
      const last = parts[parts.length-1];
      function maskWord(w){
        if(!w) return '';
        return w[0].toUpperCase() + '*'.repeat(Math.max(3, w.length-1));
      }
      return maskWord(first) + ' ' + maskWord(last);
    }

    // Basit k√ºf√ºr/uygunsuz liste (genelle≈ütirilmi≈ü). ƒ∞stersen geni≈ület.
    const BAD_WORDS = [
      'siktir','orospu','pi√ß','amcƒ±k','yarak','g√∂t','orospu√ßocuƒüu','kahpe','orospu', 'fuck', 'shit', 'bitch'
    ];
    function containsBadWord(text){
      if(!text) return false;
      const t = text.toLowerCase();
      return BAD_WORDS.some(w => {
        // kelime e≈üle≈ümesi: bo≈üluk veya sƒ±nƒ±rlarla kontrol
        try {
          const re = new RegExp('\\b' + w.replace(/[.*+?^${}()|[\]\\]/g,'\\$&') + '\\b','i');
          return re.test(t);
        } catch(e){ return t.includes(w); }
      });
    }

    // Bildirim modal kontrol√º
    const notifyOverlay = document.getElementById('notifyOverlay');
    const notifyBox = document.getElementById('notifyBox');
    const notifyIcon = document.getElementById('notifyIcon');
    const notifyText = document.getElementById('notifyText');
    const notifyReason = document.getElementById('notifyReason');
    const ringAnim = document.getElementById('ringAnim');
    const notifyClose = document.getElementById('notifyClose');

    function showNotify({type='success', title='', reason=''}) {
      notifyBox.classList.remove('success','error');
      notifyBox.classList.add(type);
      if(type === 'success'){
        notifyIcon.textContent = '‚úì';
        notifyText.textContent = title || 'Yorum ba≈üarƒ±yla eklendi.';
        notifyReason.style.display = 'none';
      } else {
        notifyIcon.textContent = '‚úï';
        notifyText.textContent = title || 'Yorum g√∂nderilemedi.';
        notifyReason.style.display = 'block';
        notifyReason.textContent = reason || '';
      }
      // k√º√ß√ºk animasyon
      ringAnim.style.display = 'block';
      notifyOverlay.style.display = 'flex';
      notifyOverlay.setAttribute('aria-hidden','false');
      // 1.6s sonra ring gizle (animasyonun tamamlandƒ±ƒüƒ±nƒ± sim√ºle eder)
      setTimeout(()=>{ ringAnim.style.display = 'none'; }, 1600);
    }
    function closeNotify(){
      notifyOverlay.style.display = 'none';
      notifyOverlay.setAttribute('aria-hidden','true');
      ringAnim.style.display = 'none';
    }
    notifyClose.addEventListener('click', closeNotify);
    notifyOverlay.addEventListener('click', (e)=>{ if(e.target === notifyOverlay) closeNotify(); });

    // ========== Yorum sistemi (Firestore realtime) ==========
    const commentForm = document.getElementById('commentForm');
    const commentList = document.getElementById('commentList');

    // Ger√ßek zamanlƒ± dinle: herkes g√∂rs√ºn
    function startRealtimeListener(){
      db.collection('comments').orderBy('timestamp','desc').onSnapshot(snapshot => {
        commentList.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          const fullName = data.fullName || '';
          const masked = maskName(fullName);
          const rating = data.rating || 0;
          const message = data.message || '';
          // sanitize
          const safeMessage = escapeHtml(message);
          // olu≈ütur
          const item = document.createElement('div');
          item.className = 'comment-item';
          item.innerHTML = `
            <div class="meta">
              <div class="avatar">${escapeHtml((masked.split(' ')[0]||'')[0]||'')}</div>
              <div>
                <div class="name">${escapeHtml(masked)}</div>
                <div class="rating">${'‚≠ê'.repeat(Math.max(0, rating))}</div>
              </div>
            </div>
            <p>${safeMessage}</p>
          `;
          commentList.appendChild(item);
        });
      }, err => {
        console.error('Realtime snapshot error', err);
      });
    }
    startRealtimeListener();

    // Form g√∂nderimi
    commentForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fullName = document.getElementById('fullName').value.trim();
      const rating = parseInt(document.getElementById('rating').value);
      const message = document.getElementById('message').value.trim();

      // Basit doƒürulama
      if(!fullName || !message || !rating){
        showNotify({type:'error', title:'L√ºtfen t√ºm alanlarƒ± doldurun!', reason:'Ad, puan ve yorum alanlarƒ± gereklidir.'});
        return;
      }

      // K√ºf√ºr filtresi
      if(containsBadWord(message) || containsBadWord(fullName)){
        showNotify({
          type:'error',
          title:'Yorumunuz kabul edilmedi',
          reason:'Yorumda uygunsuz dil veya hakaret bulunduƒüu i√ßin g√∂nderilemedi.'
        });
        return;
      }

      // G√∂nderme: Firestore
      try {
        await db.collection('comments').add({
          fullName,
          rating,
          message,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        // ba≈üarƒ± bildirimi
        showNotify({type:'success', title:'Yorum ba≈üarƒ±yla g√∂nderildi. Te≈üekk√ºrler!'});
        commentForm.reset();
      } catch(err){
        console.error(err);
        showNotify({type:'error', title:'Sunucu hatasƒ±', reason:'Yorum veritabanƒ±na eklenirken hata olu≈ütu.'});
      }
    });

    // === Ek: sayfa a√ßƒ±ldƒ±ƒüƒ±nda yorumlarƒ±n y√ºklenmesini garanti et (onSnapshot zaten yapƒ±yor) ===

  </script>

</body>
</html>
